<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>SFL Admin - Usuarios</title>
  <link rel="stylesheet" href="../Styles/bootstrap.css" />
</head>
<body class="p-4">
  <div class="container">
    <h1 class="mb-4">Usuarios</h1>

    <!-- Botón Crear -->
    <button class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#modalCreate">
      Crear Usuario
    </button>

    <table class="table table-striped align-middle">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Email</th>
          <th>Rol</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <% data.forEach(usuario => { %>
        <tr>
          <td><%= usuario.id_us %></td>
          <td><%= usuario.nom_us %></td>
          <td><%= usuario.mail_us %></td>
          <td><%= usuario.nom_rol %></td>
          <td>
            <div style="display: flex; gap: 5px">
              <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#modalEdit"
                data-id="<%= usuario.id_us %>"
                data-nombre="<%= usuario.nom_us %>"
                data-email="<%= usuario.mail_us %>"
                data-rol="<%= usuario.rol_id_rol %>">
                Editar
              </button>
              <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#modalDelete"
                data-id="<%= usuario.id_us %>"
                data-nombre="<%= usuario.nom_us %>">
                Eliminar
              </button>
            </div>
          </td>
          <td>
            <a href="/admin/users/<%= usuario.id_us %>" class="btn btn-info btn-sm">Ver Detalles</a>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <!-- Modal Crear -->
  <div class="modal fade" id="modalCreate" tabindex="-1" aria-labelledby="modalCreateLabel" aria-hidden="true">
    <div class="modal-dialog">
      <form action="/admin/users/create" method="POST" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Crear Usuario</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="nom_us_create" class="form-label">Nombre</label>
            <input type="text" name="nom_us" id="nom_us_create" class="form-control" required />
          </div>
          <div class="mb-3">
            <label for="mail_us_create" class="form-label">Email</label>
            <input type="email" name="mail_us" id="mail_us_create" class="form-control" required />
          </div>
          <div class="mb-3">
            <label for="pass_us_create" class="form-label">Contraseña</label>
            <input type="password" name="pass_us" id="pass_us_create" class="form-control" required />
          </div>
          <div class="mb-3">
            <label for="rol_id_create" class="form-label">ID Rol</label>
            <input type="number" name="rol_id_rol" id="rol_id_create" class="form-control" required />
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-success">Crear</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Editar -->
  <div class="modal fade" id="modalEdit" tabindex="-1" aria-labelledby="modalEditLabel" aria-hidden="true">
    <div class="modal-dialog">
      <form id="formEdit" method="POST" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Editar Usuario</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="id_us" id="edit_id" />
          <div class="mb-3">
            <label for="nom_us_edit" class="form-label">Nombre</label>
            <input type="text" name="nom_us" id="nom_us_edit" class="form-control" required />
          </div>
          <div class="mb-3">
            <label for="mail_us_edit" class="form-label">Email</label>
            <input type="email" name="mail_us" id="mail_us_edit" class="form-control" required />
          </div>
          <div class="mb-3">
            <label for="rol_id_edit" class="form-label">ID Rol</label>
            <input type="number" name="rol_id_rol" id="rol_id_edit" class="form-control" required />
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-primary">Guardar Cambios</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Eliminar -->
  <div class="modal fade" id="modalDelete" tabindex="-1" aria-labelledby="modalDeleteLabel" aria-hidden="true">
    <div class="modal-dialog">
      <form id="formDelete" method="POST" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Eliminar Usuario</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p>¿Estás seguro que deseas eliminar al usuario <strong id="deleteUsuarioNombre"></strong>?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-danger">Eliminar</button>
        </div>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const modalEdit = document.getElementById("modalEdit");
    modalEdit.addEventListener("show.bs.modal", function (event) {
      const button = event.relatedTarget;
      const id = button.getAttribute("data-id");
      const nombre = button.getAttribute("data-nombre");
      const email = button.getAttribute("data-email");
      const rol = button.getAttribute("data-rol");

      document.getElementById("edit_id").value = id;
      document.getElementById("nom_us_edit").value = nombre;
      document.getElementById("mail_us_edit").value = email;
      document.getElementById("rol_id_edit").value = rol;

      document.getElementById("formEdit").action = `/admin/users/update/${id}`;
    });

    const modalDelete = document.getElementById("modalDelete");
    modalDelete.addEventListener("show.bs.modal", function (event) {
      const button = event.relatedTarget;
      const id = button.getAttribute("data-id");
      const nombre = button.getAttribute("data-nombre");
      document.getElementById("deleteUsuarioNombre").textContent = nombre;
      document.getElementById("formDelete").action = `/admin/users/delete/${id}`;
    });
  </script>
</body>
</html>
