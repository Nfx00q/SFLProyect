<%- include('../../partials/header', { title: 'Detalle de Usuario' }) %>
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Perfil de Usuario - <%= usuario.nom_us %></title>
  <link rel="stylesheet" href="/Styles/bootstrap.css" />
  <!-- FontAwesome ya está cargado -->
  <style>
    .card-icon {
      font-size: 2rem;
      color: #0d6efd; /* color bootstrap primary */
      margin-bottom: 0.5rem;
    }
    .card-title {
      font-weight: 600;
      font-size: 1.25rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
      color: #0d6efd;
    }
  </style>
</head>
<body class="p-4">
  <div class="container">
    <h1 class="mb-4 text-center">
      <i class="fas fa-user-circle me-2"></i>Perfil de <%= usuario.nom_us %>
    </h1>

    <div class="row g-4">
      <!-- Datos Personales -->
      <div class="col-12 col-md-6 col-lg-4">
        <div class="card shadow-sm h-100">
          <div class="card-body">
            <div class="card-title">
              <i class="fas fa-id-card card-icon"></i>
              Datos Personales
            </div>
            <p><strong>Nombre:</strong> <%= usuario.nom_us %></p>
            <p><strong>ID:</strong> <%= usuario.id_us %></p>
            <p><strong>Email:</strong> <%= usuario.mail_us %></p>
            <p><strong>Teléfono:</strong> +56 <%= usuario.tel_us || 'No registrado' %></p>
            <p><strong>Rol:</strong> <%= rol?.nom_rol || 'Sin rol' %></p>
          </div>
        </div>
      </div>

      <!-- Dirección -->
      <div class="col-12 col-md-6 col-lg-4">
        <div class="card shadow-sm h-100">
          <div class="card-body">
            <div class="card-title">
              <i class="fas fa-map-marker-alt card-icon"></i>
              Dirección
            </div>
            <% if (direccion) { %>
              <p><strong>Calle:</strong> <%= direccion.calle %></p>
              <p><strong>Ciudad:</strong> <%= direccion.ciudad %></p>
              <p><strong>Comuna:</strong> <%= direccion.comuna %></p>
              <p><strong>Región:</strong> <%= direccion.region %></p>
              <p><strong>Código Postal:</strong> <%= direccion.cod_postal %></p>
              <p><strong>País:</strong> <%= direccion.pais %></p>
            <% } else { %>
              <p class="text-muted fst-italic">Sin dirección registrada</p>
            <% } %>
          </div>
        </div>
      </div>

      <!-- Carrito -->
      <div class="col-12 col-md-6 col-lg-4">
        <div class="card shadow-sm h-100">
          <div class="card-body">
            <div class="card-title">
              <i class="fas fa-shopping-cart card-icon"></i>
              Carrito
            </div>
            <% if (carrito && carrito.length > 0) { %>
              <ul class="list-group list-group-flush">
                <% carrito.forEach(item => { %>
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-box me-2"></i>ID: <%= item.id_carrito %></span>
                    <small class="text-muted"><%= new Date(item.fec_carrito).toLocaleString() %></small>
                    <span class="badge bg-primary rounded-pill"><%= item.es_carrito %></span>
                  </li>
                <% }) %>
              </ul>
            <% } else { %>
              <p class="text-muted fst-italic">Carrito vacío</p>
            <% } %>
          </div>
        </div>
      </div>

      <!-- Pedidos -->
      <div class="col-12 col-md-6 col-lg-4">
        <div class="card shadow-sm h-100">
          <div class="card-body">
            <div class="card-title">
              <i class="fas fa-clipboard-list card-icon"></i>
              Pedidos
            </div>
            <% if (pedidos && pedidos.length > 0) { %>
              <ul class="list-group list-group-flush">
                <% pedidos.forEach(pedido => { %>
                  <li class="list-group-item d-flex flex-column">
                    <div>
                      <i class="fas fa-receipt me-2"></i>ID: <%= pedido.id_pedido %>
                    </div>
                    <div><strong>Estado:</strong> <%= pedido.est_pedido %></div>
                    <div><strong>Total:</strong> $<%= pedido.total_pedido %></div>
                    <small class="text-muted"><%= new Date(pedido.hora_fecha).toLocaleString() %></small>
                  </li>
                <% }) %>
              </ul>
            <% } else { %>
              <p class="text-muted fst-italic">Sin pedidos</p>
            <% } %>
          </div>
        </div>
      </div>

      <!-- Envíos -->
      <div class="col-12 col-md-6 col-lg-4">
        <div class="card shadow-sm h-100">
          <div class="card-body">
            <div class="card-title">
              <i class="fas fa-truck card-icon"></i>
              Envíos
            </div>
            <% if (envios && envios.length > 0) { %>
              <ul class="list-group list-group-flush">
                <% envios.forEach(envio => { %>
                  <li class="list-group-item d-flex flex-column">
                    <div><i class="fas fa-shipping-fast me-2"></i>ID: <%= envio.id_envio %></div>
                    <div><strong>Número Seguimiento:</strong> <%= envio.num_segui %></div>
                    <div><strong>Transportista:</strong> <%= envio.transp %></div>
                    <div><strong>Estado:</strong> <%= envio.est_envio %></div>
                  </li>
                <% }) %>
              </ul>
            <% } else { %>
              <p class="text-muted fst-italic">Sin envíos</p>
            <% } %>
          </div>
        </div>
      </div>
    </div>

    <div class="text-center mt-4">
      <a href="/admin/users" class="btn btn-secondary">
        <i class="fas fa-arrow-left me-2"></i>Volver
      </a>
    </div>

    <script src="/JS/usersDetails.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </div>
</body>
</html>
